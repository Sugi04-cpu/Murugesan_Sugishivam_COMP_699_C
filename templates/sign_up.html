<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up</title>
    {% load static %}
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
  </head>
  <body>
    <!-- Header -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <div class="container">
        <a class="navbar-brand" href="{% url 'render_products' %}">E-Commerce Store</a>
      </div>
    </nav>

    <!-- Toasts for messages -->
    {% if messages %}
      <div aria-live="polite" aria-atomic="true" class="position-relative">
        <div id="toast-container" class="toast-container position-fixed top-0 end-0 p-3">
          {% for message in messages %}
            <div class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="2000" data-bs-autohide="true">
              <div class="toast-header {% if message.tags == 'error' %}bg-danger text-white{% else %}bg-success text-white{% endif %}">
                <strong class="me-auto">
                  {% if message.tags == "error" %}Error{% else %}Notification{% endif %}
                </strong>
                <small>Now</small>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
              </div>
              <div class="toast-body">
                {{ message }}
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
    {% endif %}

    <!-- Centered Sign Up Form -->
     
    <div class="container d-flex align-items-center justify-content-center" style="min-height: 89vh;">
      <div class="card p-4" style="width: 100%; max-width: 400px;">
        <h2 class="text-center mb-4">Sign Up</h2>

        {% if error %}
          <div class="alert alert-danger" role="alert">{{ error }}</div>
        {% endif %}

        <form method="POST" action="{% url 'create_user' %}">
          {% csrf_token %}
          <div class="mb-3">
            <label for="name" class="form-label">Name</label>
            <input type="text" class="form-control" id="name" name="name" placeholder="Enter Name" required>
          </div>
          <div class="mb-3">
            <label for="email" class="form-label">Email</label>
            <input type="email" class="form-control" id="email" name="email" placeholder="Enter Email" required>
          </div>
          <div class="mb-3">
            <label for="password" class="form-label">Password</label>
            <!-- Password must be at least 8 characters, one uppercase and one special character -->
            <input type="password" class="form-control" id="password" name="password" placeholder="Enter Password" required
                   pattern="^(?=.*[A-Z])(?=.*[^A-Za-z0-9]).{8,}$"
                   title="Password must be at least 8 characters long, contain at least one uppercase letter and one special character.">
                   
                    <button type="button" id="togglePassword" class="btn btn-link">
                      <i class="bi bi-eye"></i>
                    </button>
                    Show password
                  
                  </input>
            
          </div>
         
          <div class="mb-3">
            <label for="confirm_password" class="form-label">Confirm Password</label>
            <input type="password" class="form-control" id="confirm_password" placeholder="Confirm Password" required>
          </div>
          <button type="submit" class="btn btn-primary w-100">Sign Up</button>
        </form>
        <p class="mt-3">
          Already have an account? <a href="{% url 'login_view' %}">Sign In</a>
        </p>
      </div>
    </div>

    

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function(){
        // Show toast messages
        var toastElList = [].slice.call(document.querySelectorAll('.toast'));
        toastElList.forEach(function(toastEl) {
          var toast = new bootstrap.Toast(toastEl);
          toast.show();
        });

        document.getElementById('togglePassword').onclick = function() {
          if (password.type === 'password') {
              password.type = 'text';
              this.querySelector('i').className = 'bi bi-eye-slash';
          } else {
              password.type = 'password';
              this.querySelector('i').className = 'bi bi-eye';
          }
      }
        
        // Intercept form submission to delay and do custom validation
        var form = document.querySelector("form");
        form.addEventListener("submit", function(e) {
            // Prevent default form submission
            e.preventDefault(); 
          // Get password values
          var password = document.getElementById("password").value;
          var confirmPassword = document.getElementById("confirm_password").value;
            
          // Check if passwords match
          if (password !== confirmPassword) {
            // Optionally, you could show a toast or an alert
            alert("Passwords do not match.");
            return; // abort submission
          }

          form.submit();
        });
      });
    </script>
  </body>
</html>